
<a name="_ejs2zdsb6w3l"></a>**Open Source & Self Deployed SIEM**

<a name="_unn3z6c1x2n"></a>A Deep Study

—-

**By Vyom Thaker** 

-----
![Image](https://github.com/Vyom-Thaker/Open-Source-Self-Deployed-SIEM---A-Deep-Study/raw/main/Images/img1.png)

SYNOPSIS

The document is a reference for SIEM related beginner questions. 

For Example:-

1. What is a SIEM
1. What makes a SIEM
1. How a SIEM works
1. Uses of SIEM

This document will also cover how one can self deploy an SIEM using open source or freeware applications for better understanding.

## INDEX

- [**SIEM**](#_6agd2ppixml5)   **3**

    - [What is a SIEM?](#_4gugj1n57lvs)------------- 3
    - [What makes a SIEM?](#_5axnkh7wzsop)---------- 4
    - [Data Aggregation](#_f0v82oj8yw53)------------ 4
    - [Data Normalization](#_y8csmma9fbe4)---------- 4
    - [Unstructured Database](#_qgkyupbr3o5z)------- 4
    - [Query Language/System](#_yfnsvblry9bg)------- 4
    - [Data Retention](#_a12czkrvgckr)-------------- 4
    - [Correlation Engine](#_icezpm5dgccv)---------- 4
    - [How does a SIEM work?](#_cpzl6cuq1jrh)------- 5
    - [SIEM Use Cases](#_pfnxhtwrh330)-------------- 6

- [**Implementing An Open-Source SIEM Solution**](#_oa0253racdht)   **13**

    - [Components/Features](#_ns077v2rqv46)--------- 13
    - [Elasticsearch](#_5y16p7f46hct)--------------- 13
    - [Wazuh](#_kxvd9bbc0bfx)----------------------- 13
    - [Kibana](#_tlz046mgwg85)---------------------- 14
    - [Filebeat](#_3btafj8dtvuj)-------------------- 14
    - [Deployment Architecture](#_ixc2v7n9dfvy)----- 16
    - [All-in-one deployment](#_q0xs5ncast68)------- 16
    - [Distributed deployment](#_tvgx9y87bvq9)------ 17
# <a name="_6agd2ppixml5"></a>SIEM
## <a name="_4gugj1n57lvs"></a>What is a SIEM?
SIEM stands for - Security Information and Event Management. The full form in itself is enough to understand a SIEM.

Still to give a brief explanation, each host/computer/server in an organization/corporate building writes information on its local storage regarding the user events and its own system events with some vital information about these events in the form of system logs. These logs are very important for finding errors or security events related to that particular system.

Now an organization/corporate building will have 100’s to 1000’s of hosts at one location or at a different geographical location, this can be problematic if a security incident happens. It will be unfeasible for a security analyst to pinpoint the actual infected host out of so many as one cannot manually login into each host and search individually. This process of individual locating & searching can take months.

This creates a necessity for a central management or collection mechanism where information generated by each host is collected at a single location. Here, a SIEM can help us solve this problem.

SIEM helps us in collecting Security related events and information in real time and manage them at a central location. Hence the name, Security Information and Event Management.

The job of a SIEM does not end here. There are multiple roles, including managing information,  which a SIEM has to perform.

These are,

1. Data aggregation
1. Data retention
1. Normalization
1. Correlation
- Threat Hunting
- Vulnerability Detection
- Configuration Assessment
- Malware Detection
1. Alerting
1. File Integrity Monitoring


## <a name="_5axnkh7wzsop"></a>What makes a SIEM?

SIEM is a combination of Security Event Management (SEM) and Security Information Management (SIM).

There are several components which makes SIEM, these are :
### <a name="_f0v82oj8yw53"></a>Data Aggregation
Data Aggregation is the process where data is gathered and expressed in a summary form.

When data is aggregated, then the data rows typically gathered from multiple sources are replaced with totals or summary statistics.
### <a name="_y8csmma9fbe4"></a>Data Normalization
Data Normalization is the process of arranging the data in a structured manner as per their fields. It eliminates the unstructured data for our better understanding.
### <a name="_qgkyupbr3o5z"></a>Unstructured Database
Where Data is stored in an unstructured way and an unclassified way is known as Unstructured Database To make this unstructured data into a simple and structured manner the component Data Aggregation and Data Normalization is used..
### <a name="_yfnsvblry9bg"></a>Query Language/System
A Query Language / system is used to search or query in data from the database.
### <a name="_a12czkrvgckr"></a>Data Retention 
Data Retention means storing of the historical data for a long period of time for the future uses and for the analysis of the future incidents.
### <a name="_icezpm5dgccv"></a>Correlation Engine
When the data is in a structured manner then a Correlation Engine matches the data with his rules database and if any of the log is matched with the rule then the correlation engine generates the alert from which we will be aware of the activities.

Alerting System 

Alerting Systems generally send the alerts to the authorized person who will see to the alerts take action accordingly.
##
## <a name="_7zmbftl3l7xy"></a><a name="_cpzl6cuq1jrh"></a>How does a SIEM work?

As we understand in the upper sections, what is SIEM and What makes a SIEM? Now here we are going to understand about the working process of SIEM and how it gives us a Holistic view.

1. The Raw data flows from the various places into a centralized location .

1. Data ingestion is the process by which this raw data is parsed, normalized, and enriched before it is indexed in the Database

1. Then the data is stored in the database in a structured manner and the index will be prepared for our ease.

1. Once the data is stored in the database in a structured manner in appropriate places then one can insert a query and get the resulting data in a structured format.

1. Then SEIM uses the Correlation Engine as follows : 



The various appliances in your network should be constantly generating event logs that are fed into your SIEM system. A SIEM correlation rule tells your SIEM system which sequences of events could be indicative of anomalies which may suggest security weaknesses or cyber attack. When “x” and “y” or “x” and “y” plus “z” happens, your administrators should be notified.

Here are some examples of SIEM correlation rules which illustrate this concept.

- Detect new DHCP servers in your network by watching for inside or outside connections which use UDP packets (“x”), have port 67 as the destination (“y”), and the destination IP address isn’t on the registered IP list (“z”).
- Warn administrators if five failed login attempts are tried with different usernames from the same IP to the same machine within fifteen minutes (“x”), if that event is followed by a successful login occurring from that same IP address to any machine inside the network (“y”).

The example could indicate a cyber attacker establishing a DHCP server to acquire malicious access to your network. Any authorized DHCP server would use one of your registered IP addresses!
## <a name="_pfnxhtwrh330"></a>SIEM Use Cases
![Image](https://github.com/Vyom-Thaker/Open-Source-Self-Deployed-SIEM---A-Deep-Study/raw/main/Images/img2.png)

SIEM has many use cases in the modern threat landscape including detection and prevention for internal and external threats, as well as compliance with various legal standards. 

**Use cases:**


1. Log Collection

- Agentless log collection is the predominant method SIEM solutions use to collect Logs.

- In this method, the log data generated by the devices is automatically sent to a SIEM server securely.

- There is no need for an additional agent to collect the logs, which reduces the load on the devices.

- Agent-based log collection demands an agent be deployed on every device that can generate logs.

- This method can help filter out logs while collecting them, based on defined parameters.
- Agents also take up less bandwidth and resources, and help provide filtered and structured log data.


1. Log Analysis
- SIEM platforms aggregate historical log data and real-time alerts from security solutions and IT systems like email servers, web servers, and authentication systems.

- They analyze the data and establish relationships that help identify anomalies, vulnerabilities, and incidents.

- ` `The SIEM’s main focus is on security-related events such as suspicious logins, malware, or escalation of privileges.

- The SIEM’s goal is to identify which events have security significance and should be reviewed by a human analyst, and send notifications for those events. 

- ` `Modern SIEMs also provide extensive dashboards and data visualization tools, allowing analysts to actively seek data points that might indicate a security incident — known as threat hunting.    


1. Log Correlation

- SIEM event correlation is an essential part of any SIEM solution.

- It aggregates and analyzes log data from across your network applications, systems, and devices, making it possible to discover security threats and malicious patterns of behaviors that otherwise go unnoticed and can lead to compromise or data loss.

- However, in traditional SIEM platforms, correlation can get pretty complicated pretty quickly.

- ` `First, you have to collect all of the relevant security data from your applications, systems, and devices.

- ` `The most common data sources include your network IDS, vulnerability assessment tool, and your servers. 

- Once you have the data, you then have to research the threats in your environment to understand their behavior and to write correlation rules to identify it.

1. Logs Forensics

- Log forensics refers to the process of analyzing log data to identify the time a security incident was initiated, who initiated it, the sequence of actions, and the impact it had on the business. It also helps to identify the data that has been affected by an attack and to identify the attack pattern.

- Reconstruct the attack scenario and gather evidence to prove an attack.

- Meet compliance mandate requirements by demonstrating how the attack happened.

- Identify security system vulnerabilities or loopholes that led to a cyberattack to seal the loopholes and thwart future attacks.

1. IT Compliance

- Key feature of SIEM is data retention and report automation for the purposes of governance and compliance.

- A SIEM tool provides every business concerned with compliance the ability to collect data, safeguard data storage and automate the creation of regulatory reports to ensure company, industry and government compliance.

- For example, the Financial Industry Regulatory Authority (FINRA) regulates financial institutions and requires policies and procedures that keep your network secure from cyber-attacks.



1. Application Log Monitoring

- As part of the IT operational analytics, the idea is to identify and troubleshoot problems in any application by collecting and analyzing log data produced by the applications, while correlating it with log data produced by the infrastructure elements.

- Application faults often have an immediate business impact, such as unavailability of a service or feature, and even data corruption. In some cases, application faults may be also related to security issues. Therefore identifying these events can be a critical task.

- As opposed to the security logs, which are structured and predictable, the application layer springs from a multitude of developers, including in-house, commercial teams, etc.

- Since there are no industry standards for documenting and managing log events, these applications are extremely inconsistent both in terms of the IDs used for events and their wording. 

1. Object Access Auditing

- EventLog Analyzer lets you know what actually happened to your files and folders—who accessed them, deleted them, edited them, moved them, where the files and folders went, etc.

- EventLog Analyzer provides object access reports in user-friendly formats (PDF and CSV), and sends instant alerts via SMS or email when your sensitive files and folders are accessed by unauthorized people.

- You obtain precise information about object access, such as which user performed the action, what was the result of the action, on which server it happened, so you can track down the user workstation and network device from where the action was triggered



1. “Real-Time” Alerting

- SIEM solutions can be customized to business needs, making use of pre-defined, tiered alerts and notifications across multiple teams.


1. Users Activity Monitoring

- User Activity Monitoring software enables managers and admins to track and collect employee’s real-time user actions and behavior data on company networks, connected devices, and monitored workstations. 

- With the increase in open access to the internet and a more relaxed work culture, it is possible for team members to misuse the organization’s resources.

- You might have specific questions regarding your organization. Who is your most productive employee? What kind of software is utilized majorly in your organization? What time of the day is your team the most productive?

- UAM answers all of the above questions. It enables you to have an overall view of how employee activities occur in your organization.

1. Dashboard 

- An extensive SIEM system is no good if you have a poor dashboard behind it. 

- Having a dashboard with a simple user interface makes it much easier to identify threats.

- In practice, you’re looking for a dashboard with visualization.

- Straight away this allows your analyst to spot if any anomalies are occurring on the display. Ideally, you want a SIEM system that can be configured to show specific event data.



1. Reporting 

- Another facet of this security analytics component is predefined reports.

- Often, SIEM solutions are bundled with hundreds of predefined reports that help in providing visibility into security events, detecting threats, and easing security and compliance audits.

- These reports, which are mostly built based on known indicators of compromise (IoCs), can also be customized to suit internal security needs.

1. File Integrity Monitoring

- File Integrity Monitoring or FIM serves to record any changes to the file system i.e. core operating system files or program components, and the systems' configuration settings i.e. user accounts, password policy, services, installed software, management and monitoring functions, registry keys and registry values, running processes and security policy settings for audit policy settings, user rights assignment and security options.

- FIM is designed to both verify that a device remains hardened and free of vulnerabilities at all times and that the file system remains free of any malware.

- Therefore even if some form of APT malware manages to infiltrate a critical server, well-implemented FIM will detect file system changes before any rootkit protective measures that may be employed by the malware can kick in.

1. ` `Object Access Auditing

- EventLog Analyzer lets you know what actually happened to your files and folders—who accessed them, deleted them, edited them, moved them, where the files and folders went, etc.

- EventLog Analyzer provides object access reports in user-friendly formats (PDF and CSV), and sends instant alerts via SMS or email when your sensitive files and folders are accessed by unauthorized people.

- You obtain precise information about object access, such as which user performed the action, what was the result of the action, on which server it happened, so you can track down the user workstation and network device from where the action was triggered



#
# <a name="_157dsvw2hx6b"></a><a name="_oa0253racdht"></a>Implementing An Open-Source SIEM Solution 
Previously we discussed the different components of SIEM in [What makes a SIEM?](#_5axnkh7wzsop) Topic. We will now use a few freewares which will provide us with the required SIEM components/features. This will help us in achieving our goal of implementing the open-source SIEM.

The freeware we will be using are listed below with the features/component they provide us with,

## <a name="_ns077v2rqv46"></a>Components/Features
1. #### <a name="_5y16p7f46hct"></a>**Elasticsearch**
Elasticsearch is a distributed, free and open search and analytics engine for all types of data, including textual, numerical, geospatial, structured, and unstructured. 

Elasticsearch (sometimes dubbed as ES) is a modern search and analytics engine which is based on Apache Lucene. Completely open source and built with Java, Elasticsearch is a NoSQL database. That means it stores data in an unstructured way and that you cannot use SQL to query it.

Elasticsearch will provide us with below component,

- Data aggregation & Retention
- An unstructured database
- Query Language/System

1. #### <a name="_kxvd9bbc0bfx"></a>**Wazuh**
Wazuh is a free and open source platform for threat detection, security monitoring, incident response and regulatory compliance. It can be used to monitor endpoints(Windows Desktop, Windows Server, Linux Desktop, Linux Servers), cloud services and containers, and to aggregate and analyze data from external sources.

Wazuh provides analysts real-time correlation and context. Active responses are granular, encompassing on-device remediation so endpoints are kept clean and operational.

The Wazuh solution is based on the Wazuh agent, which is deployed on the monitored endpoints

In addition to agent-based monitoring capabilities, the Wazuh platform can monitor agent-less devices such as firewalls, switches, routers, or network IDS, among others. For example, a system log data can be collected via Syslog, and its configuration can be monitored through periodic probing of its data, via SSH or through an API.


Wazuh will provide us with below components,

- Data Normalization
- File integrity monitoring
- System inventory
- Cloud security
- Alerting
- Correlation Engine, the correlation engine will further expand the capabilities and provide us other additional features which are:
1. Log Correlation
1. Rootkits detection
1. Configuration assessment
1. Vulnerability detection
1. Regulatory compliance
1. Malware Detection

1. #### <a name="_tlz046mgwg85"></a>**Kibana**
Kibana is an free and open frontend application that sits on top of the Elastic Stack, providing search and data visualization capabilities for data indexed in Elasticsearch.

Kibana will provide us with below components,

- Dashboards
- Data Visualization
- Reporting
- GUI endpoint for managing Elasticsearch and Wazuh 

1. #### <a name="_3btafj8dtvuj"></a>**Filebeat**
Filebeat is a lightweight shipper for forwarding and centralizing log data. It will be used to store wazuh data in elasticsearch for data management purposes.

These four components will be configured to work together, refer below image for understanding the final architecture.This togetherness will result into a working SIEM solution.



![Image](https://github.com/Vyom-Thaker/Open-Source-Self-Deployed-SIEM---A-Deep-Study/raw/main/Images/img3.png)

- Wazuh Manager will collect security events and information from wazuh agents
- Wazuh correlation engine with help of decoders normalize the data
- The correlation engine will further correlate this normalized data with correlation rules and create alert logs
- This alert logs will be sent to elasticsearch with the help of filebeat
- Elasticsearch will index this data for query/search purposes and for data retention
- Once indexed, analysts will be able to query this security data for security activities i.e threat hunting, compliance etc.


## <a name="_ixc2v7n9dfvy"></a>Deployment Architecture
The above can be deployed in two ways

1. All-in-one
1. Distributed
### <a name="_q0xs5ncast68"></a>All-in-one deployment
Wazuh server and Elastic Stack are installed on the same host. This type of deployment is appropriate for testing and small working environments.

![Image](https://github.com/Vyom-Thaker/Open-Source-Self-Deployed-SIEM---A-Deep-Study/raw/main/Images/img4.png)

The following components will be installed:

The Wazuh server, including the Wazuh manager as a single-node cluster, and Filebeat.

Elastic Stack, including Elasticsearch as a single-node cluster, and Kibana, including the Wazuh Kibana plugin.

The communication is encrypted using certificates. Follow the installation guide to install and configure all the required components.

### <a name="_tvgx9y87bvq9"></a>Distributed deployment
Each component is installed in a separate host as a single-node or multi-node cluster. This type of deployment allows high availability and scalability of the product and is convenient for large working environments.

Kibana can be installed on the same server as the Elasticsearch node, or on a separate one. This type of deployment is appropriate for production environments as it provides high availability and scalability of the services.

![Image](https://github.com/Vyom-Thaker/Open-Source-Self-Deployed-SIEM---A-Deep-Study/raw/main/Images/img5.png)

The following components will be installed:

The Wazuh server, including the Wazuh manager as a single-node cluster or as a multi-node cluster, and Filebeat.

Elastic Stack as a single-node cluster or as a multi-node cluster, and Kibana, including the Wazuh Kibana plugin, on the same host as Elasticsearch node or on a separate one.

The communication will be encrypted using certificates, and the user can follow the installation steps guide to install all required components.
